package com.service.kafka.service.impl;

import org.springframework.kafka.annotation.KafkaListener;
import org.springframework.messaging.handler.annotation.Payload;

import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.service.kafka.constant.ErrorConstant;
import com.service.kafka.constant.MessageConstant;
import com.service.kafka.exception.AppException;
import com.service.kafka.model.PurchaseOrder;

public class PurchaseOrderListener {
	
	ObjectMapper objectMapper = new ObjectMapper();
	
	@KafkaListener(topics = "${kafka.producer.topic.name}", containerFactory = "kafkaListenerContainerFactory")
	public void listen(@Payload String message) throws AppException {

		try {
			PurchaseOrder purchaseOrder = objectMapper.readValue(message, PurchaseOrder.class);
			poService.savePO(purchaseOrder);
			LOGGER.info("Data Received: {}", purchaseOrder.getPoNumber());
		} catch (JsonProcessingException e) {
			throw new AppException(ErrorConstant.APP_ERROR_03, MessageConstant.PAYLOAD_HANDLING_ERROR);
		}
	}

}
