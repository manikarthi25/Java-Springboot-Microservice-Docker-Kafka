package com.service.kafka.service.impl;

import org.springframework.kafka.annotation.KafkaListener;
import org.springframework.messaging.handler.annotation.Payload;

import com.demo.kafka.constant.ErrorConstant;
import com.demo.kafka.constant.MessageConstant;
import com.demo.kafka.exception.AppException;
import com.demo.kafka.model.PO;
import com.fasterxml.jackson.core.JsonProcessingException;

public class PurchaseOrderListener {
	
	@KafkaListener(topics = "${kafka.producer.topic.name}", containerFactory = "kafkaListenerContainerFactory")
	public void listen(@Payload String message) throws AppException {
		LOGGER.info("Incoming Message: {}", message);

		try {
			PO po = xmlMapper.readValue(message, PO.class);
			poService.savePO(po);
			LOGGER.info("Data Received: {}", po.getPoNumber());
		} catch (JsonProcessingException e) {
			throw new AppException(ErrorConstant.APP_ERROR_03, MessageConstant.PAYLOAD_HANDLING_ERROR);
		}
	}

}
